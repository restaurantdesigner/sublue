<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://js.stripe.com/v3/"></script>

  <meta name="description" content="Alquiler y venta del scooter submarino Sublue Vapor en España. Entrega rápida, asistencia personalizada y productos originales.">
  <link rel="icon" href="img/favi.png" type="image/png">
  <title>Scooter Sublue Vapor | Alquiler y Venta</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
  window.stockData = {};

  const productImagesByColor = {
    rojavapor: [
      "img/products/vapor/aventurinaroja/roja1.webp",
      "img/products/vapor/aventurinaroja/roja2.webp",
      "img/products/vapor/aventurinaroja/roja3.webp",
      "img/products/vapor/aventurinaroja/roja4.webp",
      "img/products/vapor/aventurinaroja/roja5.webp",
      "img/products/vapor/aventurinaroja/roja6.webp",
      "img/products/vapor/aventurinaroja/roja7.webp",
      "img/products/vapor/aventurinaroja/roja8.webp",
      "img/products/vapor/aventurinaroja/roja9.webp",
      "img/products/vapor/aventurinaroja/roja10.webp",
      "img/products/vapor/aventurinaroja/roja11.webp",
      "img/products/vapor/aventurinaroja/roja12.webp",
      "img/products/vapor/aventurinaroja/roja13.webp",
      "img/products/vapor/aventurinaroja/roja14.webp",
      "img/products/vapor/aventurinaroja/roja15.webp",
      "img/products/vapor/aventurinaroja/roja16.webp",
      "img/products/vapor/aventurinaroja/roja17.webp",
      "img/products/vapor/aventurinaroja/roja18.webp",
      "img/products/vapor/aventurinaroja/roja19.webp",
      "img/products/vapor/aventurinaroja/roja20.webp",
      "img/products/vapor/aventurinaroja/roja21.webp",
      "img/products/vapor/aventurinaroja/roja22.webp"

      // ➕ Добавь больше по мере необходимости
    ],
    grisvapor: [
      "img/products/vapor/grisdravit/gris1.webp",
      "img/products/vapor/grisdravit/gris2.webp",
      "img/products/vapor/grisdravit/gris3.webp",
      "img/products/vapor/grisdravit/gris4.webp",
      "img/products/vapor/grisdravit/gris5.webp",
      "img/products/vapor/grisdravit/gris6.webp",
      "img/products/vapor/grisdravit/gris7.webp",
      "img/products/vapor/grisdravit/gris8.webp",
      "img/products/vapor/grisdravit/gris9.webp",
      "img/products/vapor/grisdravit/gris10.webp",
      "img/products/vapor/grisdravit/gris11.webp"
    ]
  };

  let selectedColor = 'Vapor Aventurina Roja';
  let currentColor = 'rojavapor';
  let currentIndex = 0;
  let startX = 0;

  function handleTouchStart(e) {
    startX = e.touches[0].clientX;
  }

  function handleTouchEnd(e) {
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    const images = productImagesByColor[currentColor];
    if (!images) return;

    if (Math.abs(diff) > 50) {
      if (diff < 0 && currentIndex < images.length - 1) {
        currentIndex++;
      } else if (diff > 0 && currentIndex > 0) {
        currentIndex--;
      }
      document.getElementById("mainImage").src = images[currentIndex];

      const thumbnails = document.getElementById("thumbnailContainer").children;
      Array.from(thumbnails).forEach((thumb, i) => {
        thumb.classList.toggle("ring-2", i === currentIndex);
        thumb.classList.toggle("ring-blue-500", i === currentIndex);
      });
    }
  }

  function setColor(color) {
    const images = productImagesByColor[color];
    if (!images) return;

    currentColor = color;
    currentIndex = 0;
    selectedColor = (color === 'rojavapor') ? 'Vapor Aventurina Roja' : 'Vapor Gris Dravit';

    const mainImage = document.getElementById("mainImage");
    const thumbnails = document.getElementById("thumbnailContainer");
    document.getElementById("colorName").textContent = selectedColor;

    mainImage.src = images[0];
    thumbnails.innerHTML = "";

    images.forEach((img, index) => {
      const thumb = document.createElement("img");
      thumb.src = img;
      thumb.className = "w-14 h-14 object-cover border rounded cursor-pointer hover:ring-2 hover:ring-blue-500";

      if (index === 0) {
        thumb.classList.add("ring-2", "ring-blue-500");
      }

      thumb.onmouseover = () => {
        mainImage.src = img;
      };

      thumb.onclick = () => {
        const allThumbs = document.querySelectorAll("#thumbnailContainer img");
        allThumbs.forEach(t => t.classList.remove("ring-2", "ring-blue-500"));
        mainImage.src = img;
        currentIndex = index;
        thumb.classList.add("ring-2", "ring-blue-500");
      };

      thumbnails.appendChild(thumb);
    });

    updateStockInfo();
    updateColorBorder();
  }

  function updateColorBorder() {
  const rojaBox = document.getElementById("colorRojaVapor");
  const grisBox = document.getElementById("colorGrisVapor");

  if (!rojaBox || !grisBox) return;

  rojaBox.classList.remove("ring-2", "ring-blue-500");
  grisBox.classList.remove("ring-2", "ring-blue-500");

  if (currentColor === "rojavapor") {
    rojaBox.classList.add("ring-2", "ring-blue-500");
  } else if (currentColor === "grisvapor") {
    grisBox.classList.add("ring-2", "ring-blue-500");
  }
}


  function updateStockInfo() {
    const productId = "vapor_" + (currentColor === 'rojavapor' ? 'roja' : 'gris');
    const stock = stockData[productId] || 0;

    const stockText = document.getElementById("stockInfo");
    if (stockText) {
      stockText.textContent = stock > 0
        ? `En stock: ${stock} unidad${stock === 1 ? '' : 'es'}`
        : "❌ No disponible";
    }

    const input = document.getElementById("quantityInput");
    if (input) {
      input.max = stock;
      if (parseInt(input.value) > stock) {
        input.value = stock;
      }
    }

    const addToCartBtn = document.querySelector("button[onclick='addToCart(event)']");
    if (addToCartBtn) {
      addToCartBtn.disabled = stock === 0;
      addToCartBtn.classList.toggle("opacity-50", stock === 0);
      addToCartBtn.classList.toggle("cursor-not-allowed", stock === 0);
    }
  }

  
async function loadStock() {
  // тело функции
}
    

  window.onload = async () => {
    await loadStock();
    setColor('rojavapor');
    updateCartCount?.();
    updateStockInfo();

    const dateEl = document.querySelector('.delivery-date');
    if (dateEl && typeof getDeliveryDate === 'function') {
      dateEl.textContent = getDeliveryDate();
    }

    const img = document.getElementById("mainImage");
    img.addEventListener("touchstart", handleTouchStart, false);
    img.addEventListener("touchend", handleTouchEnd, false);
  };

  function getDeliveryDate() {
    const now = new Date();
    now.setDate(now.getDate() + 3);
    return now.toLocaleDateString("es-ES", { day: 'numeric', month: 'short' });
  }

  let accesoriosSeleccionados = [];
  window.addToCart = addToCart;
  window.payWithStripe = payWithStripe;
  window.getDeliveryDate = getDeliveryDate;
  window.setColor = setColor;

  function validateCartAgainstStock() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    let updated = false;

    cart = cart.map(item => {
      const available = stockData[item.id] ?? Infinity;
      if (item.qty > available) {
        item.qty = available;
        updated = true;
      }
      return item;
    });

    if (updated) {
      showToast("Stock actualizado en el carrito");
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount?.();
    }
  }
</script>

<style>
@media (min-width: 1024px) {
  .site-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 60px;
    padding: 0 60px;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 1000;
  }

  .site-header .logo {
    width: 140px;
    max-width: 100%;
  }

  .site-header nav {
    display: flex;
    gap: 40px;
  }

  .site-header nav a {
    font-family: 'Inter', sans-serif;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    color: white;
    opacity: 0.7;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .site-header nav a:hover {
    opacity: 1;
  }
}

.site-header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 60px;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  z-index: 1000;
}
</style>

</head>

<body class="bg-white text-gray-800">
<header class="site-header px-4 py-2 flex justify-between items-center bg-gray-900 bg-opacity-90">

  <div class="flex items-center">
    <a href="index.html">
      <img src="img/sublue.png" alt="SUBI Logo" class="logo w-28 md:w-32 lg:w-36" />
    </a>
  </div>

  <nav class="hidden md:flex space-x-8 text-white font-semibold text-sm tracking-widest uppercase">
    <a href="index.html#catalog" class="hover:text-yellow-300 transition">Modelos</a>
    <a href="#alquiler" class="hover:text-yellow-300 transition">Alquiler</a>
    <a href="#contact" class="hover:text-yellow-300 transition">Contacto</a>
    <a href="#nosotros" class="hover:text-yellow-300 transition">Sobre nosotros</a>
    <a href="#faq" class="hover:text-yellow-300 transition">FAQ</a>
  </nav>

  <a href="cart.html" class="relative">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white hover:text-yellow-300 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.5 6h13l-1.5-6M9 21h0M15 21h0" />
    </svg>
    <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">0</span>
  </a>
</header>

<div class="max-w-7xl mx-auto px-4 py-6 pt-24">
  <div class="flex flex-col lg:flex-row gap-6">
    <div class="lg:w-1/2">
      <div class="flex flex-col lg:flex-row gap-3">
        <div id="thumbnailContainer" class="flex flex-row lg:flex-col gap-2 lg:mr-2 overflow-x-auto"></div>
        <div class="flex-1">
          <img id="mainImage" src="" alt="Main Product Image" class="w-full h-auto rounded shadow">
          <p class="text-center text-sm mt-2 text-blue-600 underline cursor-pointer">Click to see full view</p>
        </div>
      </div>
    </div>

    <div class="lg:w-1/2 pb-28 lg:pb-0">
      <h1 class="text-base sm:text-lg md:text-xl font-semibold mb-2 leading-snug">
        Vapor Scooter Submarino con Pantalla LCD, 3 Modos de Velocidad, Profundidad de 40 m, Seguridad Inteligente y Montura para Cámara
      </h1>

      <div class="flex items-center mt-1">
        <span class="text-yellow-500 text-base">★★★★☆</span>
        <span class="text-blue-600 ml-2 text-sm">15 valoraciones</span>
      </div>

      <div class="text-2xl sm:text-3xl font-bold mt-2">€3299<sup class="text-base sm:text-lg">.00</sup></div>

      <div class="mt-4">
        <span class="font-semibold text-sm">Colour Name:</span>
        <span id="colorName" class="text-sm ml-1">Vapor Aventurina Roja</span>
      </div>

      <div class="flex gap-3 mt-2">
        <div id="colorRojaVapor" onclick="setColor('rojavapor')" class="w-20 h-16 border rounded cursor-pointer ring-2 ring-blue-500">
          <img src="img/products/vapor/aventurinaroja/roja1.webp" class="w-full h-full object-cover rounded" alt="Aventurina Roja">
          <p class="text-center text-xs font-semibold">Aventurina Roja</p>
        </div>

        <div id="colorGrisVapor" onclick="setColor('grisvapor')" class="w-20 h-16 border rounded cursor-pointer">
          <img src="img/products/vapor/grisdravit/gris1.webp" class="w-full h-full object-cover rounded" alt="Gris Dravit">
          <p class="text-center text-xs font-semibold">Gris Dravit</p>
        </div>

        <!-- Выбор количества -->
        <div class="mt-4">
          <label for="quantityInput" class="font-semibold text-sm block mb-1">Cantidad:</label>
          <input type="number" id="quantityInput" value="1" min="1" class="border rounded px-2 py-1 w-24" />
        </div>
      </div>

      <!-- Дата доставки -->
      <p id="deliveryEstimate" class="text-green-600 font-semibold mt-4">
        Entrega estimada: <span class="delivery-date">...</span>
      </p>

      <!-- Информация о наличии -->
      <p id="stockInfo" class="text-sm mt-2 text-gray-700 font-semibold"></p>

      <!-- Особенности товара -->
      <ul class="list-disc list-inside mt-4 space-y-3 text-sm leading-relaxed">
        <li><strong>3 MODOS DE VELOCIDAD</strong> – Baja, Media y Turbo (hasta 10 km/h) para una experiencia personalizada bajo el agua.</li>
        <li><strong>PANTALLA LCD 4,3″</strong> – Muestra velocidad, profundidad, temperatura, batería y más.</li>
        <li><strong>ALTA SEGURIDAD</strong> – Alertas de profundidad, ascenso rápido, y parada automática.</li>
        <li><strong>HASTA 60 MINUTOS DE USO</strong> – Con batería extraíble de 13.000 mAh y carga rápida (1.5 h).</li>
        <li><strong>FLOTABILIDAD POSITIVA</strong> – El scooter flota si lo sueltas.</li>
        <li><strong>RESISTENTE HASTA 40 M</strong> – Construido para inmersiones profundas con sellado avanzado.</li>
      </ul>

      <!-- Кнопка "добавить в корзину" -->
      <button onclick="addToCart(event)" class="mt-4 bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-3 px-4 w-full rounded shadow transition">
        Añadir al carrito
      </button>

      <!-- Кнопки оплаты -->
      <div class="mt-4 flex flex-col sm:flex-row gap-3">
        <button onclick="payWithStripe()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 w-full rounded shadow transition">
          Pagar con tarjeta
        </button>

        <button class="bg-gray-800 hover:bg-black text-white font-semibold py-3 px-4 w-full rounded shadow transition">
          PayPal
        </button>
      </div>
      <!-- 📦 Accesorios adicionales -->
<div id="accesoriosSection" class="mt-6 border-t pt-6 transition-all duration-500">
  <h2 class="text-lg font-semibold mb-4">Combina bien con:</h2>

  <!-- Producto destacado -->
  <div class="flex items-center space-x-4 mb-6">
    <img src="img/products/accessories/vapor_battery.webp" alt="Vapor Batería" class="w-16 h-16 rounded object-cover" />
    <div>
      <p class="text-sm text-gray-500">Sublue</p>
      <p class="font-bold text-base">Vapor Batería</p>
      <p class="text-gray-800 text-sm">€699,00</p>
    </div>
  </div>

  <!-- Agrega Más Paga Menos -->
  <div class="bg-gray-100 p-4 rounded-lg shadow-sm">
    <p class="text-sm font-medium mb-4 flex items-center">
      <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
        d="M12 8c.828 0 1.5-.672 1.5-1.5S12.828 5 12 5s-1.5.672-1.5 1.5S11.172 8 12 8zM12 14c.828 0 1.5-.672 1.5-1.5S12.828 11 12 11s-1.5.672-1.5 1.5S11.172 14 12 14zM12 20c.828 0 1.5-.672 1.5-1.5S12.828 17 12 17s-1.5.672-1.5 1.5S11.172 20 12 20z"/></svg>
      Agrega Más Paga Menos
    </p>

    <div class="space-y-4">
      <!-- Mochila -->
      <label class="flex items-center space-x-4">
        <input type="checkbox" class="form-checkbox accent-blue-600"
          onchange="toggleAccessory(this, 12900, 'Mochila Impermeable 52L', 'img/products/accessories/backpack_52L.webp')" />
        <img src="img/products/accessories/backpack_52L.webp" alt="Mochila" class="w-14 h-14 rounded object-cover" />
        <div>
          <p class="font-semibold text-sm">Mochila Impermeable 52L</p>
          <p class="text-gray-700 text-sm">€129,00</p>
        </div>
      </label>

      <!-- Funda -->
      <label class="flex items-center space-x-4">
        <input type="checkbox" class="form-checkbox accent-blue-600"
          onchange="toggleAccessory(this, 13900, 'Funda impermeable H1+', 'img/products/accessories/phone_case.webp')" />
        <img src="img/products/accessories/phone_case.webp" alt="Funda" class="w-14 h-14 rounded object-cover" />
        <div>
          <p class="font-semibold text-sm">Funda de teléfono inteligente impermeable H1+</p>
          <p class="text-red-500 text-sm">€139,00 <span class="line-through text-gray-500 text-xs">€179,00</span></p>
        </div>
      </label>
    </div>

    <!-- Total -->
    <div class="mt-4 text-right">
      <p class="font-semibold text-base">Total adicional: <span id="accesoriosTotal">€0,00</span></p>
    </div>
  </div>
</div>

    </div>
  </div>
</div>


<!-- Модальное окно оплаты -->
<div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow max-w-sm w-full">
    <h2 class="text-lg font-semibold mb-4">Introduce tu correo electrónico para pagar</h2>
    <input
      id="emailInput"
      type="email"
      placeholder="tucorreo@ejemplo.com"
      class="w-full border border-gray-300 p-2 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
    <button
      onclick="submitPayment()"
      class="bg-blue-600 text-white w-full py-2 rounded hover:bg-blue-700 transition"
    >
      Pagar €<span id="priceSpan">1399.00</span>
    </button>
    <button
      onclick="closePaymentModal()"
      class="mt-3 text-sm text-gray-500 underline hover:text-gray-700 transition"
    >
      Cancelar
    </button>
  </div>
</div>

<!-- Всплывающее уведомление -->
<div
  id="toast"
  class="fixed bottom-5 right-5 bg-green-600 text-white text-sm px-4 py-2 rounded shadow-lg hidden z-50 transition"
>
  Añadido al carrito
</div>

<footer class="bg-gray-900 text-white px-6 pt-0 pb-10 z-10 overflow-hidden">
  <!-- Контент футера -->
  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 mt-10">
    <!-- Контакты -->
    <div class="space-y-2">
      <h2 class="text-xl font-semibold">Contacto</h2>
      <p class="text-sm">Av. de Andalucía, 3, 29751 Algarrobo-Costa, Málaga</p>
      <p class="text-sm">
        Tel: <a href="tel:+34692828614" class="hover:underline">+34 692 828 614</a>, 
        <a href="tel:+34614140871" class="hover:underline">+34 614 140 871</a>
      </p>
      <p class="text-sm">Email: <a href="mailto:subluespana@gmail.com" class="hover:underline">subluespana@gmail.com</a></p>
    </div>

    <!-- Кнопки -->
    <div class="space-y-2">
      <h2 class="text-xl font-semibold">Información</h2>
      <div class="text-sm text-white">
        <a href="#" onclick="document.getElementById('modalCondicionesAlquiler').classList.remove('hidden')">Condiciones de alquiler</a>
        <a href="#" onclick="document.getElementById('modalCondicionesVenta').classList.remove('hidden')" class="ml-4">Condiciones de venta</a>
        <a href="#" onclick="document.getElementById('modalCondicionesEntrega').classList.remove('hidden')" class="ml-4">Condiciones de entrega</a>
      </div>
    </div>
  </div>

  <!-- Нижняя часть -->
  <div class="max-w-7xl mx-auto mt-10 border-t border-gray-700 pt-6 flex flex-col items-center space-y-4 text-sm text-gray-400">
    <p>
      Hecho por 
      <a href="https://3dna.es" class="underline hover:text-white transition" target="_blank">3DNA.es</a> – Agencia Creativa
    </p>

    <!-- Иконки соцсетей -->
    <div class="flex gap-6">
      <!-- Facebook -->
      <a href="https://www.facebook.com/sublue_spain" target="_blank" class="text-gray-400 hover:text-white transition" aria-label="Facebook">
        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
          <path d="M22 12a10 10 0 10-11.5 9.9v-7H8v-3h2.5V9.2c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.3c-1.3 0-1.7.8-1.7 1.6v1.9h3l-.5 3h-2.5v7A10 10 0 0022 12z"/>
        </svg>
      </a>

      <!-- Instagram -->
      <a href="https://www.instagram.com/sublue_spain" target="_blank" class="text-gray-400 hover:text-white transition" aria-label="Instagram">
        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
          <path d="M7 2C4.8 2 3 3.8 3 6v12c0 2.2 1.8 4 4 4h10c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4H7zm10 2c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10zm-5 3a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6zm4.8-.8a1.2 1.2 0 11-2.4 0 1.2 1.2 0 012.4 0z"/>
        </svg>
      </a>

      <!-- WhatsApp -->
      <a href="https://wa.me/34692828614" target="_blank" class="text-gray-400 hover:text-white transition" aria-label="WhatsApp">
        <svg class="w-6 h-6 fill-current" viewBox="0 0 32 32">
          <path d="M16 2.7A13.3 13.3 0 002.7 16c0 2.3.6 4.4 1.7 6.3L2 30l7.9-2.4a13.2 13.2 0 006.1 1.5A13.3 13.3 0 0016 2.7zm0 24.3c-1.9 0-3.8-.5-5.4-1.4l-.4-.2-4.7 1.4 1.5-4.6-.3-.4a11 11 0 1119.2-6.1 11 11 0 01-9.9 11.3zm6-8.3c-.3-.1-1.7-.9-2-1-.3-.1-.5-.2-.7.2s-.8 1-1 1.2c-.2.1-.4.1-.7 0-.3-.1-1.3-.5-2.5-1.6a9.3 9.3 0 01-1.7-2.2c-.2-.3 0-.5.1-.7l.4-.6c.1-.2.2-.4.3-.6.1-.2 0-.5 0-.7 0-.2-.7-1.8-1-2.5-.2-.5-.5-.5-.7-.5h-.6c-.2 0-.5.1-.7.3a3 3 0 00-1 2.2 5.2 5.2 0 001.1 2.6 11 11 0 004.7 4.1c1.8.7 2.2.6 2.6.5.4-.1 1.3-.6 1.5-1.1.2-.5.2-1 .1-1.2z"/>
        </svg>
      </a>
    </div>

    <!-- Логотип -->
    <img src="/img/lg.png" alt="3DNA Logo" class="h-6 grayscale hover:grayscale-0 transition" />
  </div>
</footer>

<!-- Модальное окно: Condiciones de alquiler -->
<div id="modalCondicionesAlquiler" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 hidden">
  <div class="bg-white w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-xl shadow-lg p-6 relative">
    <button onclick="document.getElementById('modalCondicionesAlquiler').classList.add('hidden')" class="absolute top-4 right-4 text-gray-500 hover:text-black text-2xl">&times;</button>
    <h2 class="text-2xl font-bold mb-4">Condiciones Generales de Alquiler de Equipos Recreativos</h2>
    <p class="mb-4">Torre del Mar, provincia de Málaga</p>
    <h3 class="font-semibold mt-6 mb-2">1. Objeto del Alquiler</h3>
    <p>El arrendador pone a disposición del arrendatario uno o varios equipos recreativos...</p>
    <!-- ... Остальной текст остаётся без изменений ... -->
  </div>
</div>

<!-- Модальные окна: venta и entrega -->
<div id="modalVenta" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 relative">
    <button onclick="document.getElementById('modalVenta').classList.add('hidden')" class="absolute top-2 right-2 text-gray-500 hover:text-black text-2xl">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Condiciones de venta</h2>
    <p class="text-gray-700 text-sm">Aquí puedes añadir tus condiciones de venta detalladas...</p>
  </div>
</div>

<div id="modalEntrega" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 relative">
    <button onclick="document.getElementById('modalEntrega').classList.add('hidden')" class="absolute top-2 right-2 text-gray-500 hover:text-black text-2xl">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Condiciones de entrega</h2>
    <p class="text-gray-700 text-sm">Aquí puedes añadir tus condiciones de entrega detalladas...</p>
  </div>
</div>




<script>
// 🌐 Глобальные переменные
let stockData = {};




// 📦 Загрузка остатков со склада (Google Sheets CSV)
async function loadStock() {
  try {
    const response = await fetch("https://docs.google.com/spreadsheets/d/1oFM818LNbAgwb-SQBZxmH2UaG2RJQg1nFJymO7THpDw/export?format=csv&gid=0");
    const csv = await response.text();
    const lines = csv.trim().split("\n");

    lines.forEach((line, index) => {
      if (index === 0) return;
      const cells = line.split(",");
      const id = cells[0]?.trim();
      const stock = parseInt(cells[4]?.trim());
      if (id && !isNaN(stock)) {
        stockData[id] = stock;
      }
    });

    console.log("✅ Stock cargado:", stockData);
    updateStockInfo();
  } catch (err) {
    console.error("❌ Error al cargar stock:", err);
  }
}

// 🎨 Маппинг цвета в ID товара
const colorToStockId = {
  rojavapor: "vapor_roja",
  grisvapor: "vapor_gris"
};

// 🛒 Добавление товара в корзину
function addToCart(event) {
  event.stopPropagation();

  const quantity = parseInt(document.getElementById("quantityInput").value) || 1;
  const mainImage = document.getElementById("mainImage").src;
  const productId = colorToStockId[currentColor];

  const mainItem = {
    id: productId,
    name: "Sublue Vapor",
    color: selectedColor,
    price: 3299,
    qty: quantity,
    image: mainImage,
    delivery: getDeliveryDate()
  };

  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  const existing = cart.find(p =>
    p.id === mainItem.id &&
    p.color === mainItem.color &&
    p.image === mainItem.image
  );

  const alreadyInCart = existing ? existing.qty : 0;
  const totalRequested = alreadyInCart + quantity;
  const availableStock = stockData[productId] || 0;

  if (totalRequested > availableStock) {
    alert(`Lo sentimos, solo quedan ${availableStock} unidades. Ya tienes ${alreadyInCart} en el carrito.`);
    return;
  }

  if (existing) {
    existing.qty += quantity;
  } else {
    cart.push(mainItem);
  }

  accesoriosSeleccionados.forEach(accessory => {
    const found = cart.find(p => p.id === accessory.id);
    if (!found) cart.push({ ...accessory });
  });

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount();
  showToast("Añadido al carrito");
}

// 🧾 Stripe оплата
async function payWithStripe() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];

  if (cart.length === 0) {
    alert("¡Tu carrito está vacío!");
    return;
  }

  const items = cart.map(item => ({
    id: item.id,
    name: item.name + (item.color ? ` - ${item.color}` : ""),
    description: item.description || "Producto Sublue",
    price: Number(item.price),
    quantity: item.qty || 1,
    image: item.image
  }));

  try {
    const response = await fetch("http://192.168.1.118:4242/create-checkout-session", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ items })
    });

    const data = await response.json();
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert("Error: " + data.error);
    }
  } catch (error) {
    alert("Error al crear la sesión de pago: " + error.message);
  }
}

// 🎒 Аксессуары
function toggleAccessory(checkbox, price, name, image) {
  const item = {
    id: 'acc_' + name.toLowerCase().replace(/\s+/g, '_'),
    name,
    description: 'Accesorio adicional',
    price,
    quantity: 1,
    image
  };

  if (checkbox.checked) {
    accesoriosSeleccionados.push(item);
  } else {
    accesoriosSeleccionados = accesoriosSeleccionados.filter(i => i.id !== item.id);
  }

  updateAccessoryTotal();
}

function updateAccessoryTotal() {
  const total = accesoriosSeleccionados.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const totalText = (total / 100).toFixed(2).replace('.', ',');
  document.getElementById('accesoriosTotal').textContent = `€${totalText}`;
}

// 📦 Показ количества на складе
function updateStockInfo() {
  const productId = colorToStockId[currentColor];
  const stock = stockData[productId] ?? 0;

  const stockEl = document.getElementById("stockInfo");
  if (stockEl) {
    stockEl.textContent =
      stock > 0
        ? `En stock: ${stock} unidad${stock === 1 ? "" : "es"}`
        : "❌ No disponible";
  }

  const btn = document.querySelector("button[onclick='addToCart(event)']");
  if (btn) {
    btn.disabled = stock === 0;
    btn.classList.toggle("opacity-50", stock === 0);
    btn.classList.toggle("cursor-not-allowed", stock === 0);
  }
}

// 🛍️ Количество в корзине
function updateCartCount() {
  try {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const totalQty = cart.reduce((sum, item) => sum + (parseInt(item.qty) || 0), 0);
    const countEl = document.getElementById("cartCount");
    if (countEl) {
      countEl.textContent = totalQty > 0 ? totalQty : '';
      countEl.classList.toggle("hidden", totalQty === 0);
    }
  } catch (e) {
    console.error("Error loading cart:", e);
  }
}

// 🔔 Уведомление
function showToast(message) {
  const toast = document.getElementById("toast");
  if (toast) {
    toast.textContent = message;
    toast.classList.remove("hidden");
    setTimeout(() => toast.classList.add("hidden"), 3000);
  }
}

// 📅 Дата доставки
function getDeliveryDate() {
  const now = new Date();
  now.setDate(now.getDate() + 7);
  return now.toLocaleDateString("es-ES");
}

// 🚀 Инициализация при загрузке

window.addEventListener("DOMContentLoaded", () => {
  loadStock();
  updateCartCount();
  updateStockInfo();

  const dateEl = document.querySelector(".delivery-date");
  if (dateEl) dateEl.textContent = getDeliveryDate();
});
</script>







</body>
</html>
